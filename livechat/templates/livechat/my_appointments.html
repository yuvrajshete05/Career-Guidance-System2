{% extends "app1/base.html" %}
{% block title %}My Appointments{% endblock %}
{% block content %}
<h2>My Appointments</h2>

<h3>Your Booked Appointments:</h3>
{% if user_appointments %}
    <ul>
        {% for appt in user_appointments %}
            <li>
                With: {{ appt.counselor.username }} |
                Time: {{ appt.start_time|date:"D, d M Y H:i" }} |
                Status: {{ appt.get_status_display }}
                {% if appt.meeting_link %}<br><a href="{{ appt.meeting_link }}" target="_blank">Meeting Link</a>{% endif %}
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p>You have no booked appointments.</p>
{% endif %}

{% if request.user.is_staff or request.user.has_perm('livechat.can_be_counselor') %} {# Or check for CounselorProfile #}
<h3>Appointments as Counselor:</h3>
{% if counselor_appointments %}
    <ul>
        {% for appt in counselor_appointments %}
            <li>
                For: {{ appt.user.username }} |
                Time: {{ appt.start_time|date:"D, d M Y H:i" }} |
                Status: {{ appt.get_status_display }}
                {% if appt.meeting_link %}<br><a href="{{ appt.meeting_link }}" target="_blank">Meeting Link</a>{% endif %}
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p>You have no appointments as a counselor.</p>
{% endif %}
{% endif %}
{% endblock %}